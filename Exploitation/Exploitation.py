import duckdb
import glob
import time
import os
import pandas as pd
import numpy as np

def Exploitation(filepath):
    conn = duckdb.connect()
    # Display our tables in duckdb
    file_list = os.listdir(filepath)
    # Initialize dataframes to store the data
    for file in file_list:
        if file.endswith(".csv"):
            # Check if the file name contains "owid" or "worldometer"
            if "Owid_preprocessed" in file:
                owid = pd.read_csv(filepath+file)
            elif "Worldometer_preprocessed" in file:
                worldometer = pd.read_csv(filepath+file)
    # Merging dataframes
    merged_df = pd.merge(worldometer,owid,left_on = ['Country,Other','Date'], right_on =['location','date'])

    # Saving it
    output_file = os.path.join(filepath, 'Final_database.csv')
    merged_df.to_csv(output_file)


